var tribe_tickets_rsvp_block={events:{}};!function(t,e){"use strict";e.state={submitActive:!0},e.tribe_rsvp_toggle_actions=function(t){var e=t.hasClass("tribe-block__rsvp__status-button--going")?".tribe-block__rsvp__status-button--not-going":".tribe-block__rsvp__status-button--going",i=t.closest(".tribe-block__rsvp__status").find(e);t.addClass("tribe-active"),t.removeClass("tribe-inactive"),t.attr("disabled","disabled"),i.addClass("tribe-inactive"),i.removeClass("tribe-active"),i.removeAttr("disabled")},e.events.handle_rsvp_response=function(){var i=t(this),s=i.closest(".tribe-block__rsvp"),n=s.find(".tribe-block__rsvp__ticket"),r=n.data("rsvp-id"),_=i.hasClass("tribe-block__rsvp__status-button--going");e.tribe_rsvp_toggle_actions(i);var a={action:"rsvp-form",ticket_id:r,going:_?"yes":"no"};e.tribe_rsvp_loader_start(),t.post(TribeRsvp.ajaxurl,a,function(t){s.find(".tribe-block__rsvp__message__success").remove();var i=n.find(".tribe-block__rsvp__form");if(i.html(t.data.html),window.tribe_event_tickets_plus){var r=i.find("input.tribe-tickets-quantity");window.tribe_event_tickets_plus.meta.block_set_quantity(r,_)}e.validate_submission(i)||(i.find(".tribe-block__rsvp__submit-button").prop("disabled",!0),e.state.submitActive=!1);e.tribe_rsvp_loader_end()})},e.events.handle_quantity_change=function(e){e.preventDefault();var i=t(this).parent().find('input[type="number"]'),s=t(this).hasClass("tribe-block__rsvp__number-input-button--plus"),n=i[0].step?Number(i[0].step):1,r=Number(i[0].value);if(s){var _=i[0].max?Number(i[0].max):-1;if("function"==typeof i[0].stepUp)try{if(_<r+n)return;i[0].stepUp()}catch(t){i[0].value=-1===_||_>=r+n?r+n:_}else i[0].value=-1===_||_>=r+n?r+n:_}else{var a=i[0].min?Number(i[0].min):0;if("function"==typeof i[0].stepDown)try{i[0].stepDown()}catch(t){i[0].value=a<=r-n?r-n:a}else i[0].value=a<=r-n?r-n:a}r!==i[0].value&&i.trigger("change")},e.events.handle_quantity_change_value=function(e){e.preventDefault();const i=t(e.target),s=i.attr("max");let n=parseInt(i.val(),10);s<(n=isNaN(n)?0:n)&&(n=s,i.val(s)),e.preventDefault()},e.events.handle_input_focus=function(i){e.state.submitActive||(t(i.target).siblings(".tribe-block__rsvp__submit-button").attr("disabled",!1),e.state.submitActive=!0)},e.tribe_rsvp_loader_start=function(e){t(".tribe-block__rsvp").find(".tribe-block__rsvp__loading").removeClass("tribe-common-a11y-hidden")},e.tribe_rsvp_loader_end=function(e){t(".tribe-block__rsvp").find(".tribe-block__rsvp__loading").addClass("tribe-common-a11y-hidden")},e.validate_submission=function(t){var e=t.find("input.tribe-tickets-quantity"),i=t.find("input.tribe-tickets-full-name"),s=t.find("input.tribe-tickets-email");return i.val().trim().length&&s.val().trim().length&&parseInt(e.val(),10)>0},e.events.handle_submission=function(i){i.preventDefault();var s=t(this).closest(".tribe-block__rsvp__ticket"),n=s.data("rsvp-id"),r=s.find("form"),_=e.validate_submission(r),a=!0,o=!!window.tribe_event_tickets_plus;if(o&&(a=window.tribe_event_tickets_plus.meta.validate_meta(r)),_&&a){var b=r.serializeArray();b.push({name:"action",value:"rsvp-process"}),b.push({name:"ticket_id",value:n}),e.tribe_rsvp_loader_start(),t.post(TribeRsvp.ajaxurl,b,function(t){var i=t.data.remaining;s.find(".tribe-block__rsvp__details .tribe-block__rsvp__availability").replaceWith(t.data.remaining_html),s.find(".tribe-block__rsvp__form").empty(),s.closest(".tribe-block__rsvp").append(t.data.html),0===i&&s.find(".tribe-block__rsvp__status").replaceWith(t.data.status_html),e.tribe_rsvp_loader_end()})}else _?r.find(".tribe-block__rsvp__message__error").hide():r.find(".tribe-block__rsvp__message__error").show(),o&&a?r.find(".tribe-event-tickets-meta-required-message").hide():r.find(".tribe-event-tickets-meta-required-message").show(),t("html, body").animate({scrollTop:r.offset().top-100},300)},e.bind_events=function(){t(".tribe-block__rsvp__ticket").on("click",".tribe-block__rsvp__status-button--going, .tribe-block__rsvp__status-button--not-going",e.events.handle_rsvp_response).on("click",'button[type="submit"]',e.events.handle_submission).on("click",".tribe-block__rsvp__number-input-button--minus, .tribe-block__rsvp__number-input-button--plus",e.events.handle_quantity_change).on("change keyup",".tribe-tickets-quantity",e.events.handle_quantity_change_value).on("focus",".tribe-tickets-full-name, .tribe-tickets-email",e.events.handle_input_focus)},e.init=function(){t(".tribe-block__rsvp").length&&e.bind_events()},e.init()}(jQuery,tribe_tickets_rsvp_block);